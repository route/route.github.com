<!DOCTYPE html>
<html>
  <head>
    <title>Query Trail</title>
    <meta charset='utf-8' />
    <link href="/stylesheets/application.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/application.js" type="text/javascript"></script>
  </head>
  <body>
    <div class='content'>
      <header>
        <a href="/">Blog</a>
      </header>
      <article>
  <h1>Query Trail</h1>
  <time>August 10, 2014</time>
  <p>Recently I switched on a project with lots of legacy code. It was on Rails 2,
Rails 3 and now I&#39;ve updated it to Rails 4.1. You can&#39;t even imagine how much
rubbish I got rid of. But the thing I&#39;d like to share with you today is
<a href="https://github.com/route/query_trail">QueryTrail</a>. This simple but useful gem
shows you the backtrace of fired queries. You have to agree that when just one
action of your controller sends hundreds sql requests from helpers, templates
and so forth, it&#39;s definitely hard to locate the place for specific query. But
not for now:</p>
<div class='codeblock'><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">User</span> <span class="n">Load</span> <span class="p">(</span>0<span class="p">.</span>4<span class="n">ms</span><span class="p">)</span>  <span class="n">SELECT</span>  `<span class="n">users</span>`<span class="o">.*</span> <span class="n">FROM</span> `<span class="n">users</span>`  <span class="n">WHERE</span> `<span class="n">users</span>`<span class="p">.</span>`<span class="n">id</span>` <span class="p">=</span> 1 <span class="n">LIMIT</span> 1
<span class="n">Query</span> <span class="n">Trail</span><span class="p">:</span> <span class="n">config</span><span class="o">/</span><span class="n">initializers</span><span class="o">/</span><span class="n">warden</span><span class="p">.</span><span class="n">rb</span><span class="p">:</span>11<span class="p">:</span><span class="n">in</span> `<span class="n">block</span> <span class="n">in</span> <span class="o">&lt;</span><span class="n">top</span> <span class="p">(</span><span class="n">required</span><span class="p">)</span><span class="o">&gt;</span><span class="s">&#39;</span>
<span class="s">             config/initializers/warden.rb:15:in `block in &lt;top (required)&gt;&#39;</span>
<span class="n">Doc</span> <span class="n">Load</span> <span class="p">(</span>18<span class="p">.</span>2<span class="n">ms</span><span class="p">)</span>  <span class="n">SELECT</span> `<span class="n">docs</span>`<span class="o">.*</span> <span class="n">FROM</span> `<span class="n">docs</span>`  <span class="n">WHERE</span> `<span class="n">docs</span>`<span class="p">.</span>`<span class="n">approved</span>` <span class="p">=</span> 1
<span class="n">Query</span> <span class="n">Trail</span><span class="p">:</span> <span class="n">app</span><span class="o">/</span><span class="n">views</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">_docs</span><span class="p">.</span><span class="n">html</span><span class="p">.</span><span class="n">erb</span><span class="p">:</span>2
             <span class="n">app</span><span class="o">/</span><span class="n">helpers</span><span class="o">/</span><span class="n">docs_helper</span><span class="p">.</span><span class="n">rb</span><span class="p">:</span>3<span class="p">:</span><span class="n">in</span> `<span class="n">render_main_block</span><span class="o">&#39;</span>
             <span class="n">app</span><span class="o">/</span><span class="n">views</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">html</span><span class="p">.</span><span class="n">erb</span><span class="p">:</span>13
             <span class="n">app</span><span class="o">/</span><span class="n">views</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">index</span><span class="p">.</span><span class="n">html</span><span class="p">.</span><span class="n">erb</span><span class="p">:</span>9
</pre></div>
</td></tr></table></div>
  <div class='share'>
    <a class="twitter-share-button" data-via="rO_Oute" href="https://twitter.com/share">Tweet</a>
    <script type='text/javascript'>
      //<![CDATA[
        !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
      //]]>
    </script>
  </div>
</article>
      <footer>
        Copyright © 2012-2014
        <a target="_blank" href="https://github.com/route">Dmitry Vorotilin</a>
        |
        <a target="_blank" href="cv.html">CV</a>
        |
        <a target="_blank" href="http://evrone.com">Evrone.com</a>
      </footer>
      <div class='yandex_metrika'>
        <!-- Yandex.Metrika informer -->
        <a href="https://metrika.yandex.ru/stat/?id=25785359&amp;from=informer"
        target="_blank" rel="nofollow"><img src="//bs.yandex.ru/informer/25785359/1_0_FFFFFFFF_EFEFEFFF_0_pageviews"
        style="width:80px; height:15px; border:0;" alt="Яндекс.Метрика" title="Яндекс.Метрика: данные за сегодня (просмотры)" /></a>
        <!-- /Yandex.Metrika informer -->
        
        <!-- Yandex.Metrika counter -->
        <script type="text/javascript">
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter25785359 = new Ya.Metrika({id:25785359,
                            webvisor:true,
                            clickmap:true,
                            trackLinks:true,
                            accurateTrackBounce:true});
                } catch(e) { }
            });
        
            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
            s.type = "text/javascript";
            s.async = true;
            s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";
        
            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else { f(); }
        })(document, window, "yandex_metrika_callbacks");
        </script>
        <noscript><div><img src="//mc.yandex.ru/watch/25785359" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
        <!-- /Yandex.Metrika counter -->
      </div>
    </div>
  </body>
</html>

